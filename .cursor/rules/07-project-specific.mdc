---
description: "Regras especÃ­ficas do projeto modern-dashboard-visions"
globs: ["**/*"]
alwaysApply: true
---

# ğŸ—ï¸ PROJETO MODERN-DASHBOARD-VISIONS - REGRAS ESPECÃFICAS

## ğŸ“Š ARQUITETURA DO PROJETO

### ğŸŒ **Stack TecnolÃ³gico**
```
modern-dashboard-visions/
â”œâ”€â”€ ğŸ“± frontend/ (React + TypeScript + Vite)
â”‚   â”œâ”€â”€ src/components/ (UI Components)
â”‚   â”œâ”€â”€ src/pages/ (Page Components)
â”‚   â”œâ”€â”€ src/services/ (API Communication)
â”‚   â””â”€â”€ src/types/ (TypeScript Definitions)
â”œâ”€â”€ ğŸ—ï¸ backend/ (Node.js + Express + Prisma)
â”‚   â”œâ”€â”€ src/controllers/ (Route Handlers)
â”‚   â”œâ”€â”€ src/services/ (Business Logic)
â”‚   â”œâ”€â”€ src/routes/ (API Routes)
â”‚   â””â”€â”€ prisma/ (Database Schema)
â””â”€â”€ ğŸ“š docs/ (Documentation)
```

### ğŸ”— **IntegraÃ§Ã£o Frontend-Backend**
- **Frontend Port**: 8080 (Vite dev server)
- **Backend Port**: 3000 (Express server)
- **Database**: PostgreSQL via Prisma ORM
- **Authentication**: JWT tokens
- **API Pattern**: RESTful com validaÃ§Ã£o Zod

## ğŸ¯ COMANDOS ESPECÃFICOS DO PROJETO

### ğŸš€ **Scripts de Desenvolvimento**
```bash
# Iniciar servidores (usar scripts prontos)
npm run dev              # Root: inicia ambos os servidores
cd frontend && npm run dev    # Frontend apenas
cd backend && npm run dev     # Backend apenas

# Database
cd backend && npx prisma studio    # Interface do banco
cd backend && npx prisma migrate dev    # Migrations

# Build
cd frontend && npm run build    # Build de produÃ§Ã£o
```

### ğŸ“‹ **Estrutura de Comandos por Contexto**
```bash
# Para bugs de UI/Frontend:
cd frontend
npm run dev
# Investigar em: src/components/, src/pages/, src/services/

# Para bugs de API/Backend:
cd backend
npm run dev
npx prisma studio
# Investigar em: src/controllers/, src/services/, src/routes/

# Para bugs de Database:
cd backend
npx prisma studio
npx prisma migrate dev
# Investigar em: prisma/schema.prisma, migrations/
```

## ğŸ” PADRÃ•ES DE INVESTIGAÃ‡ÃƒO ESPECÃFICOS

### ğŸ¯ **Para Problemas de Reservas**
```bash
# InvestigaÃ§Ã£o paralela obrigatÃ³ria:
- codebase_search: "reservation" OR "reserva"
- grep_search: "ReservationService" OR "reservaService"
- read_file: "backend/src/services/reservaService.ts"
- read_file: "frontend/src/services/reservaService.ts"
- file_search: "reservation" (buscar componentes relacionados)
```

### ğŸ¯ **Para Problemas de CrÃ©ditos**
```bash
# InvestigaÃ§Ã£o paralela obrigatÃ³ria:
- codebase_search: "credit" OR "credito"
- grep_search: "CreditService" OR "creditoService"
- read_file: "backend/src/services/creditoService.ts"
- read_file: "frontend/src/services/creditoService.ts"
- web_search: "sistema creditos spa nodejs best practices"
```

### ğŸ¯ **Para Problemas de AutenticaÃ§Ã£o**
```bash
# InvestigaÃ§Ã£o paralela obrigatÃ³ria:
- codebase_search: "auth" OR "login" OR "token"
- grep_search: "AuthContext" OR "useAuth"
- read_file: "frontend/src/contexts/AuthContext.tsx"
- read_file: "backend/src/middleware/auth.ts"
- read_file: "backend/src/controllers/authController.ts"
```

## ğŸ—ï¸ PADRÃ•ES ARQUITETURAIS DO PROJETO

### ğŸ“¡ **API Communication Pattern**
```typescript
// âœ… PADRÃƒO DO PROJETO: Service layer
// frontend/src/services/baseService.ts
export class BaseService {
  protected async request<T>(
    endpoint: string,
    options: RequestOptions = {}
  ): Promise<T> {
    const token = getAuthToken();
    
    console.log('ğŸ“¡ API Request:', {
      endpoint,
      method: options.method || 'GET',
      hasToken: !!token,
      timestamp: new Date().toISOString()
    });

    try {
      const response = await fetch(`${API_BASE_URL}${endpoint}`, {
        ...options,
        headers: {
          'Content-Type': 'application/json',
          ...(token && { 'Authorization': `Bearer ${token}` }),
          ...options.headers
        }
      });

      console.log('ğŸ“¥ API Response:', {
        endpoint,
        status: response.status,
        ok: response.ok
      });

      if (!response.ok) {
        throw new Error(`API Error: ${response.status}`);
      }

      return await response.json();
    } catch (error) {
      console.error('âŒ API Error:', {
        endpoint,
        error: error.message
      });
      throw error;
    }
  }
}
```

### âš›ï¸ **React Component Pattern**
```typescript
// âœ… PADRÃƒO DO PROJETO: Page components
// frontend/src/pages/client/Dashboard.tsx
export const Dashboard: React.FC = () => {
  const { user } = useAuth();
  const { data: reservations, isLoading, error } = useReservations(user?.id);

  console.log('âš›ï¸ Dashboard Mount:', {
    userId: user?.id,
    hasReservations: !!reservations?.length,
    isLoading,
    error: error?.message
  });

  if (isLoading) return <DashboardSkeleton />;
  if (error) return <ErrorMessage error={error} />;

  return (
    <div className="dashboard">
      <Header user={user} />
      <MainContent reservations={reservations} />
      <Sidebar />
    </div>
  );
};
```

### ğŸ—ï¸ **Backend Controller Pattern**
```typescript
// âœ… PADRÃƒO DO PROJETO: Controller + Service
// backend/src/controllers/reservaController.ts
export const createReservation = async (req: Request, res: Response) => {
  const traceId = generateTraceId();
  
  console.log('ğŸ¯ Create Reservation Request:', {
    traceId,
    userId: req.user?.id,
    body: sanitizePayload(req.body)
  });

  try {
    const validatedData = CreateReservationSchema.parse(req.body);
    
    const reservation = await reservaService.create({
      ...validatedData,
      userId: req.user!.id
    });

    console.log('âœ… Reservation Created:', {
      traceId,
      reservationId: reservation.id,
      status: reservation.status
    });

    res.status(201).json({
      success: true,
      data: reservation,
      meta: { traceId }
    });
  } catch (error) {
    console.error('âŒ Create Reservation Error:', {
      traceId,
      error: error.message,
      stack: error.stack
    });

    res.status(500).json({
      success: false,
      error: 'Failed to create reservation',
      meta: { traceId }
    });
  }
};
```

## ğŸ“‹ CHECKLIST ESPECÃFICO DO PROJETO

### âœ… **Antes de Implementar Funcionalidade**
- [ ] Verificar se existe service layer correspondente
- [ ] Validar schema Prisma se envolve database
- [ ] Verificar autenticaÃ§Ã£o/autorizaÃ§Ã£o necessÃ¡ria
- [ ] Implementar logging em frontend e backend
- [ ] Testar integraÃ§Ã£o entre camadas

### âœ… **Para Bugs de Reservas**
- [ ] Verificar reservaService (frontend e backend)
- [ ] Validar schema de Reservation no Prisma
- [ ] Testar fluxo completo: UI â†’ API â†’ Database
- [ ] Verificar integraÃ§Ã£o com sistema de crÃ©ditos
- [ ] Validar regras de negÃ³cio (horÃ¡rios, disponibilidade)

### âœ… **Para Bugs de CrÃ©ditos**
- [ ] Verificar creditoService (frontend e backend)
- [ ] Validar transaÃ§Ãµes de dÃ©bito/crÃ©dito
- [ ] Testar sincronizaÃ§Ã£o com reservas
- [ ] Verificar saldo e histÃ³rico
- [ ] Validar regras de negÃ³cio (mÃ­nimo, mÃ¡ximo)

## ğŸš« ANTI-PATTERNS ESPECÃFICOS DO PROJETO

### âŒ **NÃ£o Seguir Estrutura de Pastas**
```typescript
// âŒ INCORRETO: Arquivo na pasta errada
// frontend/src/utils/ReservationCard.tsx

// âœ… CORRETO: Seguir estrutura estabelecida
// frontend/src/components/ReservationCard.tsx
```

### âŒ **NÃ£o Usar Service Layer**
```typescript
// âŒ INCORRETO: Fetch direto no componente
const Component = () => {
  const [data, setData] = useState([]);
  
  useEffect(() => {
    fetch('/api/reservations')
      .then(res => res.json())
      .then(setData);
  }, []);
};

// âœ… CORRETO: Usar service layer
const Component = () => {
  const { data, isLoading, error } = useReservations();
  // Service layer handle fetch, caching, error handling
};
```

### âŒ **NÃ£o Implementar Logging Adequado**
```typescript
// âŒ INCORRETO: Sem logging
const createReservation = async (data) => {
  return await reservaService.create(data);
};

// âœ… CORRETO: Com logging estruturado
const createReservation = async (data) => {
  console.log('ğŸ¯ Creating Reservation:', {
    userId: data.userId,
    serviceId: data.serviceId,
    timestamp: new Date().toISOString()
  });
  
  try {
    const result = await reservaService.create(data);
    
    console.log('âœ… Reservation Created:', {
      id: result.id,
      status: result.status
    });
    
    return result;
  } catch (error) {
    console.error('âŒ Reservation Creation Failed:', {
      error: error.message,
      data: sanitizePayload(data)
    });
    throw error;
  }
};
```

## ğŸ¯ DEBUGGING ESPECÃFICO DO PROJETO

### ğŸ” **Fluxo de Debugging para Reservas**
1. **Frontend**: Verificar useReservations hook e ReservationCard
2. **Service**: Verificar reservaService (frontend e backend)
3. **API**: Verificar reservaController e routes
4. **Database**: Verificar schema Prisma e queries
5. **Integration**: Verificar creditoService integration

### ğŸ” **Logs EspecÃ­ficos para Acompanhar**
```typescript
// Logs crÃ­ticos do projeto:
console.log('ğŸ” Auth Check:', { hasToken, userRole });
console.log('ğŸ“¡ API Call:', { endpoint, method, userId });
console.log('ğŸ’³ Credit Check:', { userId, currentBalance, requiredAmount });
console.log('ğŸ“… Reservation Flow:', { step, data, status });
console.log('ğŸ”„ State Change:', { component, from, to, trigger });
``` 